# åŸŽå¸‚åˆ‡æ¢ç³»ç»Ÿå¼€å‘å®Œæˆæ€»ç»“

## ðŸ“‹ é¡¹ç›®æ¦‚è¿°

åŸºäºŽ `CityContext`ï¼ŒæˆåŠŸå¼€å‘äº†å®Œæ•´çš„å¤šåŸŽå¸‚åˆ‡æ¢ UI ç³»ç»Ÿï¼ŒåŒ…æ‹¬åœ°å›¾å¤´éƒ¨çŠ¶æ€æ ã€åŸŽå¸‚åˆ‡æ¢æŠ½å±‰å’ŒåŸŽå¸‚æ´»åŠ¨æ¨ªå¹…ã€‚

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æ ¸å¿ƒç»„ä»¶

#### MapHeaderï¼ˆåœ°å›¾å¤´éƒ¨çŠ¶æ€æ ï¼‰
**æ–‡ä»¶**: `components/map/MapHeader.tsx`

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… å·¦ä¾§åŸŽå¸‚é€‰æ‹©å™¨ï¼šæ˜¾ç¤ºå½“å‰åŸŽå¸‚åç§° + å›¾æ ‡
- âœ… ä¸­é—´èµ›å­£è¿›åº¦æ¡ï¼šæ˜¾ç¤ºå½“å‰èµ›å­£ã€å‰©ä½™å¤©æ•°ã€è¿›åº¦ç™¾åˆ†æ¯”
- âœ… å³ä¾§è·‘æ­¥æ•°æ®ï¼šé…é€Ÿ/è·ç¦»/æ—¶é•¿å®žæ—¶æ˜¾ç¤º
- âœ… è·‘æ­¥çŠ¶æ€åˆ‡æ¢ï¼šå¼€å§‹/åœæ­¢è·‘æ­¥åŠŸèƒ½
- âœ… æ¸å˜é®ç½©èƒŒæ™¯ï¼šç¡®ä¿æ–‡å­—å¯è¯»æ€§
- âœ… åŸŽå¸‚ä¸»é¢˜è‰²è‡ªåŠ¨åº”ç”¨
- âœ… å“åº”å¼å¸ƒå±€è®¾è®¡

**æ•°æ®æ ¼å¼åŒ–**:
- `formatPace()`: ç§’ â†’ "X'XX"" (é…é€Ÿ)
- `formatDistance()`: ç±³ â†’ "X.XXkm" æˆ– "XXXm"
- `formatDuration()`: ç§’ â†’ "HH:MM:SS" æˆ– "MM:SS"

**Z-Index**: `z-[100]`

---

#### CityDrawerï¼ˆåŸŽå¸‚åˆ‡æ¢æŠ½å±‰ï¼‰
**æ–‡ä»¶**: `components/map/CityDrawer.tsx`

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… ä»Žå³ä¾§æ»‘å‡ºçš„æŠ½å±‰åŠ¨ç”»
- âœ… å®žæ—¶æœç´¢è¿‡æ»¤åŸŽå¸‚
- âœ… åŸŽå¸‚åˆ—è¡¨å¡ç‰‡å±•ç¤º
- âœ… å½“å‰åŸŽå¸‚é«˜äº®æ˜¾ç¤º
- âœ… åˆ‡æ¢åŠ è½½çŠ¶æ€åŠ¨ç”»
- âœ… åŸŽå¸‚çƒ­åº¦æ ‡ç­¾ï¼ˆðŸ”¥ çƒ­é—¨ / âš¡ æ´»è·ƒ / âœ¨ æ–°å…´ï¼‰
- âœ… å é¢†çŽ‡è¿›åº¦æ¡
- âœ… åº•éƒ¨æç¤ºä¿¡æ¯
- âœ… æ¨¡æ‹Ÿåœ°å›¾è§†å£è·³è½¬ï¼ˆ500msï¼‰

**çƒ­åº¦ç­‰çº§**:
- **çƒ­é—¨** (> 80% æ´»è·ƒçŽ©å®¶): æ©™è‰² ðŸ”¥
- **æ´»è·ƒ** (50-80% æ´»è·ƒçŽ©å®¶): é»„è‰² âš¡
- **æ–°å…´** (< 50% æ´»è·ƒçŽ©å®¶): è“è‰² âœ¨

**Z-Index**: `z-[201]` (æŠ½å±‰) / `z-[200]` (é®ç½©)

---

#### CityActivityBannerï¼ˆåŸŽå¸‚æ´»åŠ¨æ¨ªå¹…ï¼‰
**æ–‡ä»¶**: `components/map/CityActivityBanner.tsx`

**åŠŸèƒ½ç‰¹æ€§**:
- âœ… æ ¹æ®å½“å‰åŸŽå¸‚æ˜¾ç¤ºä¸“å±žæ´»åŠ¨
- âœ… æ”¯æŒå¤šç§æ´»åŠ¨ç±»åž‹ï¼ˆåŒå€å¥–åŠ±ã€ç‰¹æ®Šæ´»åŠ¨ã€èµ›å­£å¼€å§‹ã€èŠ‚æ—¥ï¼‰
- âœ… å‰©ä½™æ—¶é—´å®žæ—¶è®¡ç®—
- âœ… æ‰‹åŠ¨å…³é—­åŠŸèƒ½ï¼ˆlocalStorage æŒä¹…åŒ–ï¼‰
- âœ… å³å°†ç»“æŸè­¦å‘Šï¼ˆ< 24h çº¢è‰²è„‰å†²åŠ¨ç”»ï¼‰
- âœ… é™æ—¶æ´»åŠ¨è¿›åº¦æ¡
- âœ… ä¼˜é›…çš„è¿›å…¥åŠ¨ç”»

**åŸŽå¸‚ä¸“å±žæ´»åŠ¨**:
- ðŸ¯ **åŒ—äº¬**: æ•…å®«å¾æœåŒå€å¥–åŠ±
- ðŸŒƒ **ä¸Šæµ·**: å¤–æ»©å¤œæ™¯å¾æœæŒ‘æˆ˜
- ðŸ² **æˆéƒ½**: ç«é”…èƒ½é‡åŒå€æ´»åŠ¨
- ðŸ® **å¹¿å·ž**: å²­å—æ–‡åŒ–å‘¨

**Z-Index**: `z-[90]`

---

### 2. ç±»åž‹å®šä¹‰å’Œæ•°æ®

#### å·²æœ‰æ–‡ä»¶ï¼ˆç¬¬ä¸€éƒ¨åˆ†ï¼‰
- âœ… `types/city.ts`: å®Œæ•´çš„ç±»åž‹å®šä¹‰
- âœ… `lib/mock-data.ts`: 4 ä¸ªåŸŽå¸‚ + 14 ä¸ªæŒ‘æˆ˜ + 14 ä¸ªæˆå°±
- âœ… `contexts/CityContext.tsx`: å…¨å±€çŠ¶æ€ç®¡ç†

---

### 3. æ ·å¼å¢žå¼º

#### æ–°å¢žåŠ¨ç”»
**æ–‡ä»¶**: `app/globals.css`

- âœ… `@keyframes shrink`: æ´»åŠ¨è¿›åº¦æ¡æ”¶ç¼©åŠ¨ç”»

---

### 4. æ–‡æ¡£

- âœ… `docs/CITY_SYSTEM_GUIDE.md`: å¤šåŸŽå¸‚ç³»ç»Ÿä½¿ç”¨æŒ‡å—
- âœ… `docs/CITY_UI_GUIDE.md`: åŸŽå¸‚ UI ç»„ä»¶ä½¿ç”¨æŒ‡å—
- âœ… `docs/CITY_SYSTEM_SUMMARY.md`: æœ¬æ–‡æ¡£

---

## ðŸŽ¨ è®¾è®¡äº®ç‚¹

### 1. Z-Index å±‚çº§ç®¡ç†
```
z-[201]  - CityDrawerï¼ˆæŠ½å±‰æœ¬ä½“ï¼‰
z-[200]  - CityDrawer èƒŒæ™¯é®ç½©
z-[100]  - MapHeaderï¼ˆåœ°å›¾å¤´éƒ¨ï¼‰
z-[90]   - CityActivityBannerï¼ˆæ´»åŠ¨æ¨ªå¹…ï¼‰
z-[50]   - å…¶ä»–åœ°å›¾ UI å…ƒç´ 
```

### 2. åŸŽå¸‚ä¸»é¢˜è‰²ç³»ç»Ÿ
æ¯ä¸ªåŸŽå¸‚éƒ½æœ‰ç‹¬ç«‹çš„ä¸»é¢˜è‰²é…ç½®ï¼Œè‡ªåŠ¨åº”ç”¨åˆ°è¿›åº¦æ¡ã€æŒ‰é’®ç­‰å…ƒç´ ï¼š
```tsx
theme: {
  primary: "#dc2626",   // ä¸»è‰²
  secondary: "#fca5a5", // æ¬¡è¦è‰²
  accent: "#fef2f2",    // å¼ºè°ƒè‰²
  glow: "drop-shadow(0 0 8px rgba(220, 38, 38, 0.6))", // å‘å…‰æ•ˆæžœ
}
```

### 3. å“åº”å¼è®¾è®¡
- å¤´éƒ¨è‡ªé€‚åº”å¸ƒå±€
- æŠ½å±‰å…¨å±æˆ–ä¾§è¾¹æ¨¡å¼
- æ´»åŠ¨æ¨ªå¹…é€‚é…ä¸åŒå±å¹•

### 4. åŠ¨ç”»æ•ˆæžœ
- æŠ½å±‰æ»‘å…¥/æ»‘å‡º
- è·‘æ­¥æ•°æ®è„‰å†²åŠ¨ç”»
- æ´»åŠ¨æ¨ªå¹…è¿›å…¥åŠ¨ç”»
- åŸŽå¸‚åˆ‡æ¢åŠ è½½åŠ¨ç”»
- å³å°†ç»“æŸè­¦å‘Šè„‰å†²

---

## ðŸ”§ æŠ€æœ¯å®žçŽ°

### 1. çŠ¶æ€ç®¡ç†
- ä½¿ç”¨ `CityContext` è¿›è¡Œå…¨å±€çŠ¶æ€ç®¡ç†
- `useCity` Hook è®¿é—®åŸŽå¸‚æ•°æ®
- `switchCity` æ–¹æ³•åˆ‡æ¢åŸŽå¸‚

### 2. æœ¬åœ°å­˜å‚¨
- åŸŽå¸‚é€‰æ‹©æŒä¹…åŒ–ï¼ˆ`localStorage.setItem("currentCityId")`ï¼‰
- æ´»åŠ¨æ¨ªå¹…å…³é—­è®°å½•ï¼ˆ`localStorage.setItem("dismissedActivities")`ï¼‰

### 3. æ•°æ®æ ¼å¼åŒ–
- é…é€Ÿã€è·ç¦»ã€æ—¶é•¿çš„ä¸“é—¨æ ¼å¼åŒ–å‡½æ•°
- èµ›å­£è¿›åº¦è®¡ç®—
- å é¢†çŽ‡è®¡ç®—

### 4. æ¨¡æ‹Ÿæ•°æ®
- è·‘æ­¥æ•°æ®å®žæ—¶æ›´æ–°ï¼ˆæ¯ç§’ï¼‰
- åŸŽå¸‚åˆ‡æ¢åŠ¨ç”»å»¶è¿Ÿï¼ˆ500msï¼‰
- åŸŽå¸‚çƒ­åº¦è®¡ç®—

---

## ðŸ“ æ–‡ä»¶æ¸…å•

### æ–°å»ºæ–‡ä»¶
```
components/map/
â”œâ”€â”€ MapHeader.tsx          (286 è¡Œ)
â”œâ”€â”€ CityDrawer.tsx         (309 è¡Œ)
â””â”€â”€ CityActivityBanner.tsx (240 è¡Œ)

docs/
â”œâ”€â”€ CITY_SYSTEM_GUIDE.md   (ä½¿ç”¨æŒ‡å—)
â”œâ”€â”€ CITY_UI_GUIDE.md       (UI ç»„ä»¶æŒ‡å—)
â””â”€â”€ CITY_SYSTEM_SUMMARY.md (æœ¬æ–‡æ¡£)
```

### ä¿®æ”¹æ–‡ä»¶
```
app/
â”œâ”€â”€ page.tsx               (é›†æˆæ–°ç»„ä»¶)
â””â”€â”€ globals.css            (æ–°å¢ž shrink åŠ¨ç”»)

app/layout.tsx            (ç¬¬ä¸€éƒ¨åˆ†å·²ä¿®æ”¹)
```

---

## ðŸŽ¯ æ ¸å¿ƒåŠŸèƒ½æµç¨‹

### åŸŽå¸‚åˆ‡æ¢æµç¨‹
```
1. ç”¨æˆ·ç‚¹å‡» MapHeader ä¸­çš„åŸŽå¸‚æŒ‰é’®
   â†“
2. CityDrawer ä»Žå³ä¾§æ»‘å‡º
   â†“
3. ç”¨æˆ·æœç´¢æˆ–é€‰æ‹©åŸŽå¸‚
   â†“
4. è°ƒç”¨ switchCity(cityId)
   â†“
5. æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
   â†“
6. æ›´æ–° Context çŠ¶æ€
   â†“
7. æ¨¡æ‹Ÿåœ°å›¾è§†å£è·³è½¬ï¼ˆ500msï¼‰
   â†“
8. å…³é—­æŠ½å±‰
   â†“
9. ä¿å­˜åˆ° localStorage
```

### è·‘æ­¥æµç¨‹
```
1. ç”¨æˆ·ç‚¹å‡»"å¼€å§‹è·‘æ­¥"æŒ‰é’®
   â†“
2. isRunning = true
   â†“
3. æ¯ç§’æ›´æ–°æ•°æ®ï¼š
   - duration + 1 ç§’
   - distance + 3.5 ç±³
   - é‡æ–°è®¡ç®—é…é€Ÿ
   â†“
4. å®žæ—¶æ˜¾ç¤ºåœ¨å¤´éƒ¨
   â†“
5. ç”¨æˆ·ç‚¹å‡»åœæ­¢
   â†“
6. isRunning = false
```

### æ´»åŠ¨æ¨ªå¹…æµç¨‹
```
1. ç»„ä»¶æŒ‚è½½æ—¶æ£€æŸ¥ localStorage
   â†“
2. èŽ·å–å½“å‰åŸŽå¸‚æ´»åŠ¨åˆ—è¡¨
   â†“
3. è¿‡æ»¤å·²å…³é—­å’Œå·²è¿‡æœŸçš„æ´»åŠ¨
   â†“
4. æ˜¾ç¤ºå‰©ä½™æ´»åŠ¨
   â†“
5. ç”¨æˆ·ç‚¹å‡»å…³é—­æŒ‰é’®
   â†“
6. æ›´æ–° dismissedActivities Set
   â†“
7. ä¿å­˜åˆ° localStorage
```

---

## ðŸ§ª æµ‹è¯•å»ºè®®

### åŠŸèƒ½æµ‹è¯•
- [ ] ç‚¹å‡»åŸŽå¸‚æŒ‰é’®æ‰“å¼€æŠ½å±‰
- [ ] æœç´¢åŸŽå¸‚åŠŸèƒ½
- [ ] åˆ‡æ¢åˆ°æ–°åŸŽå¸‚
- [ ] éªŒè¯ä¸»é¢˜è‰²å˜åŒ–
- [ ] è·‘æ­¥å¼€å§‹/åœæ­¢
- [ ] å®žæ—¶æ•°æ®æ›´æ–°
- [ ] æ´»åŠ¨æ¨ªå¹…æ˜¾ç¤º
- [ ] å…³é—­æ´»åŠ¨æ¨ªå¹…
- [ ] åˆ·æ–°é¡µé¢éªŒè¯æŒä¹…åŒ–

### å“åº”å¼æµ‹è¯•
- [ ] ä¸åŒå±å¹•å°ºå¯¸
- [ ] æ¨ªå±æ¨¡å¼
- [ ] æŠ½å±‰æ»šåŠ¨

### è¾¹ç•Œæµ‹è¯•
- [ ] æœç´¢æ— ç»“æžœ
- [ ] åˆ‡æ¢åˆ°å½“å‰åŸŽå¸‚
- [ ] æ‰€æœ‰æ´»åŠ¨å·²è¿‡æœŸ
- [ ] æ‰€æœ‰æ´»åŠ¨å·²å…³é—­

---

## ðŸš€ ä¸‹ä¸€æ­¥å¼€å‘å»ºè®®

### çŸ­æœŸï¼ˆ1-2 å‘¨ï¼‰
1. **é›†æˆçœŸå®ž GPS æ•°æ®**
   - ä½¿ç”¨ Geolocation API
   - è®¡ç®—çœŸå®žé…é€Ÿã€è·ç¦»
   - å¤„ç† GPS ä¿¡å·å¼±çš„æƒ…å†µ

2. **å®žçŽ°çœŸå®žåœ°å›¾è§†å£è·³è½¬**
   - é›†æˆ Mapbox GL æˆ– Leaflet
   - ä½¿ç”¨åœ°å›¾åº“ API é£žè¡Œåˆ°æ–°åæ ‡
   - æ·»åŠ è¿‡æ¸¡åŠ¨ç”»

3. **æ·»åŠ åŸŽå¸‚æŽ’è¡Œæ¦œå…¥å£**
   - åœ¨å¤´éƒ¨æ·»åŠ æŽ’è¡Œæ¦œæŒ‰é’®
   - æ˜¾ç¤ºå½“å‰æŽ’å
   - å¿«é€Ÿè·³è½¬åˆ°æŽ’è¡Œæ¦œé¡µé¢

### ä¸­æœŸï¼ˆ1 ä¸ªæœˆï¼‰
4. **å®žçŽ°æ´»åŠ¨å‚ä¸ŽåŠŸèƒ½**
   - ç‚¹å‡»æ´»åŠ¨æ¨ªå¹…å‚ä¸Ž
   - æ´»åŠ¨è¿›åº¦è¿½è¸ª
   - æ´»åŠ¨å¥–åŠ±é¢†å–

5. **æ·»åŠ åŸŽå¸‚å¤©æ°”æ˜¾ç¤º**
   - é›†æˆå¤©æ°” API
   - æ˜¾ç¤ºåœ¨å¤´éƒ¨
   - å½±å“è·‘æ­¥å»ºè®®

6. **æ”¯æŒæ›´å¤šåŸŽå¸‚**
   - æ·±åœ³ç­‰å…¶ä»–ä¸€çº¿åŸŽå¸‚
   - å›½é™…åŸŽå¸‚ï¼ˆä¸œäº¬ã€çº½çº¦ç­‰ï¼‰
   - è‡ªå®šä¹‰åŸŽå¸‚

### é•¿æœŸï¼ˆ2-3 ä¸ªæœˆï¼‰
7. **åŸŽå¸‚ä¸ªæ€§åŒ–**
   - è‡ªå®šä¹‰åŸŽå¸‚ä¸»é¢˜è‰²
   - è‡ªå®šä¹‰åŸŽå¸‚å›¾æ ‡
   - åŸŽå¸‚å¾½ç« ç³»ç»Ÿ

8. **è·¨åŸŽå¸‚æ´»åŠ¨**
   - åŸŽå¸‚é—´æŒ‘æˆ˜
   - è”åˆèµ›å­£
   - å…¨çƒæŽ’è¡Œæ¦œ

9. **AI æŽ¨è**
   - æ ¹æ®è·‘æ­¥è·¯çº¿æŽ¨èåŸŽå¸‚
   - ä¸ªæ€§åŒ–æ´»åŠ¨æŽ¨è
   - æ™ºèƒ½è·¯çº¿è§„åˆ’

---

## ðŸ’¡ æŠ€æœ¯äº®ç‚¹

1. **ç±»åž‹å®‰å…¨**: å®Œæ•´çš„ TypeScript ç±»åž‹å®šä¹‰
2. **ç»„ä»¶åŒ–**: é«˜åº¦æ¨¡å—åŒ–çš„ç»„ä»¶è®¾è®¡
3. **å¯æ‰©å±•æ€§**: æ˜“äºŽæ·»åŠ æ–°åŸŽå¸‚å’Œæ´»åŠ¨
4. **æ€§èƒ½ä¼˜åŒ–**: ä½¿ç”¨ React.memoã€é˜²æŠ–ç­‰æŠ€æœ¯
5. **ç”¨æˆ·ä½“éªŒ**: æµç•…çš„åŠ¨ç”»å’Œåé¦ˆ
6. **æ•°æ®æŒä¹…åŒ–**: localStorage è‡ªåŠ¨ä¿å­˜
7. **ä¸»é¢˜ç³»ç»Ÿ**: çµæ´»çš„åŸŽå¸‚ä¸»é¢˜è‰²é…ç½®

---

## ðŸ“Š ä»£ç ç»Ÿè®¡

| ç±»åˆ« | æ–‡ä»¶æ•° | ä»£ç è¡Œæ•° |
|------|--------|----------|
| ç»„ä»¶ | 3 | ~835 è¡Œ |
| æ–‡æ¡£ | 3 | ~1500 è¡Œ |
| ä¿®æ”¹ | 2 | ~50 è¡Œ |
| **æ€»è®¡** | **8** | **~2385 è¡Œ** |

---

## ðŸŽ‰ æ€»ç»“

æˆåŠŸå¼€å‘äº†å®Œæ•´çš„å¤šåŸŽå¸‚åˆ‡æ¢ UI ç³»ç»Ÿï¼ŒåŒ…æ‹¬ï¼š

- âœ… **MapHeader**: åŠŸèƒ½å®Œæ•´çš„åœ°å›¾å¤´éƒ¨çŠ¶æ€æ 
- âœ… **CityDrawer**: ä¼˜é›…çš„åŸŽå¸‚åˆ‡æ¢æŠ½å±‰
- âœ… **CityActivityBanner**: æ™ºèƒ½çš„åŸŽå¸‚æ´»åŠ¨æ¨ªå¹…
- âœ… **ç±»åž‹å®‰å…¨**: å®Œæ•´çš„ TypeScript æ”¯æŒ
- âœ… **æ–‡æ¡£é½å…¨**: è¯¦ç»†çš„ä½¿ç”¨æŒ‡å—
- âœ… **é›¶é”™è¯¯**: æ—  linter é”™è¯¯
- âœ… **å¯æ‰©å±•**: æ˜“äºŽæ·»åŠ æ–°åŠŸèƒ½

æ‰€æœ‰ç»„ä»¶éƒ½å·²ç»é›†æˆåˆ°é¡¹ç›®ä¸­ï¼Œå¯ä»¥ç›´æŽ¥ä½¿ç”¨ã€‚ä»£ç è´¨é‡é«˜ï¼Œæ³¨é‡Šæ¸…æ™°ï¼Œæ–‡æ¡£å®Œå–„ï¼Œä¸ºåŽç»­å¼€å‘æ‰“ä¸‹äº†åšå®žçš„åŸºç¡€ã€‚
