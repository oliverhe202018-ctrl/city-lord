# City Lord - åŸå¸‚é¢†ä¸»

City Lord æ˜¯ä¸€æ¬¾ç»“åˆçœŸå®åœ°ç†ä½ç½®ï¼ˆLBSï¼‰çš„è·‘æ­¥é¢†åœ°äº‰å¤ºæ¸¸æˆã€‚ç©å®¶é€šè¿‡åœ¨ç°å®ä¸–ç•Œä¸­è·‘æ­¥æ¥å é¢†åœ°å›¾ä¸Šçš„å…­è¾¹å½¢åœ°å—ï¼ŒåŠ å…¥é˜µè¥ï¼ˆèµ¤çº¢å…ˆé”‹ vs è”šè“è”ç›Ÿï¼‰ï¼Œä¸åŒåŸçš„è·‘è€…ç«äº‰ï¼Œæ‰©å¼ é¢†åœ°ï¼Œèµ¢å–è£èª‰ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§ (Features)

*   **å®æ—¶åœ°ç†ä½ç½®è¿½è¸ª**: ä½¿ç”¨é«˜å¾·åœ°å›¾ä¸ GPSï¼Œç²¾å‡†è¿½è¸ªç”¨æˆ·è·‘æ­¥è·¯å¾„ã€‚
*   **é¢†åœ°äº‰å¤º**: åœ¨åœ°å›¾ä¸Šç»˜åˆ¶é—­ç¯è·¯å¾„ä»¥å é¢†å…­è¾¹å½¢åœ°å—ï¼Œæ‰©å¤§ä½ çš„é¢†åœ°ã€‚
*   **é˜µè¥å¯¹æŠ—**: åŠ å…¥ä¸¤å¤§é˜µè¥ä¹‹ä¸€ï¼Œå‚ä¸åŸå¸‚çº§åˆ«çš„é¢†åœ°äº‰å¤ºæˆ˜ã€‚
*   **ä¿±ä¹éƒ¨ç³»ç»Ÿ**: åˆ›å»ºæˆ–åŠ å…¥ä¿±ä¹éƒ¨ï¼Œä¸ä¼™ä¼´å…±åŒæˆ˜æ–—ï¼Œå‚ä¸ä¿±ä¹éƒ¨æ’åã€‚
*   **æ²‰æµ¸å¼è·‘æ­¥æ¨¡å¼**: ä¸“ä¸ºè·‘æ­¥è®¾è®¡çš„ UIï¼Œå®æ—¶æ˜¾ç¤ºé€Ÿåº¦ã€è·ç¦»ã€å¡è·¯é‡Œç­‰æ•°æ®ã€‚
*   **æ™ºèƒ½è·¯å¾„è§„åˆ’å™¨**: é¢„å…ˆè§„åˆ’è·‘æ­¥è·¯çº¿ï¼Œæ”¯æŒæ‰“ç‚¹å’Œæ‰‹ç»˜æ¨¡å¼ï¼Œå¹¶èƒ½é¢„ä¼°å é¢†é¢ç§¯ã€‚
*   **ç¦»çº¿ä¼˜å…ˆæ¶æ„ (PWA)**: æé€ŸåŠ è½½ï¼Œæ”¯æŒç¦»çº¿ä½¿ç”¨ï¼Œç½‘ç»œæ¢å¤åè‡ªåŠ¨åŒæ­¥æ•°æ®ã€‚
*   **æˆå°±ä¸æ’è¡Œæ¦œ**: è§£é”å„ç§æˆå°±ï¼Œåœ¨ä¸ªäººã€ä¿±ä¹éƒ¨å’Œçœçº§æ’è¡Œæ¦œä¸Šäº‰å¤ºè£è€€ã€‚

## ğŸ’» æŠ€æœ¯æ ˆ (Tech Stack)

*   **å‰ç«¯**: Next.js 16 (App Router), React 19, Tailwind CSS v4, TypeScript
*   **åœ°å›¾**: é«˜å¾·åœ°å›¾ JS API, Turf.js, H3.js
*   **åŸç”Ÿå®¹å™¨**: Capacitor 6 (iOS & Android)
*   **åç«¯ & æ•°æ®åº“**: Supabase (PostgreSQL, Auth, Realtime)
*   **çŠ¶æ€ç®¡ç†**: Zustand, TanStack Query (SWR)
*   **UI ç»„ä»¶**: Shadcn UI

## ğŸš€ æœ¬åœ°å¼€å‘ (Getting Started)

**ç¯å¢ƒè¦æ±‚:**
*   Node.js >= 20.x
*   pnpm (æ¨è)

**å®‰è£…ä¸å¯åŠ¨:**

1.  **å…‹éš†ä»“åº“**
    ```bash
    git clone <repository-url>
    cd city-lord-game-interface
    ```

2.  **å®‰è£…ä¾èµ–**
    ```bash
    npm install
    ```

3.  **é…ç½®ç¯å¢ƒå˜é‡**
    *   å¤åˆ¶ `.env.example` æ–‡ä»¶ä¸º `.env.local`ã€‚
    *   å¡«å…¥ä½ çš„ Supabase é¡¹ç›® URL, anon key, ä»¥åŠé«˜å¾·åœ°å›¾ API Keyã€‚
    ```env
    # Supabase
    NEXT_PUBLIC_SUPABASE_URL=YOUR_SUPABASE_URL
    NEXT_PUBLIC_SUPABASE_ANON_KEY=YOUR_SUPABASE_ANON_KEY
    SUPABASE_SERVICE_ROLE_KEY=YOUR_SUPABASE_SERVICE_ROLE_KEY

    # Database URLs (for Prisma)
    DATABASE_URL="postgresql://..."
    DIRECT_URL="postgresql://..."

    # Gaode Maps API Key
    NEXT_PUBLIC_AMAP_KEY=YOUR_AMAP_KEY
    ```

4.  **ç”Ÿæˆ Prisma Client**
    *   æ¯æ¬¡ä¿®æ”¹ `prisma/schema.prisma` åéƒ½éœ€è¦æ‰§è¡Œæ­¤å‘½ä»¤ã€‚
    ```bash
    npx prisma generate
    ```

5.  **å¯åŠ¨å¼€å‘æœåŠ¡å™¨**
    ```bash
    npm run dev
    ```
    åº”ç”¨å°†è¿è¡Œåœ¨ `http://localhost:3000`ã€‚

## éƒ¨ç½² (Deployment)

é¡¹ç›®å·²é…ç½®ä¸ºå¯ä»¥éƒ¨ç½²åˆ° Vercel æˆ–å…¶ä»–æ”¯æŒ Next.js çš„å¹³å°ã€‚

1.  **æ„å»ºé¡¹ç›®**
    ```bash
    npm run build
    ```
2.  ç¡®ä¿æ‰€æœ‰ç¯å¢ƒå˜é‡éƒ½å·²åœ¨éƒ¨ç½²å¹³å°ä¸Šæ­£ç¡®é…ç½®ã€‚

## ğŸ“‚ é¡¹ç›®ç»“æ„ (Project Structure)

```
/
â”œâ”€â”€ app/                # Next.js App Router - é¡µé¢å’Œè·¯ç”±
â”‚   â”œâ”€â”€ (main)/         # ä¸»åº”ç”¨é¡µé¢
â”‚   â”œâ”€â”€ api/            # API è·¯ç”± (Serverless Functions)
â”‚   â””â”€â”€ admin/          # åå°ç®¡ç†é¡µé¢
â”œâ”€â”€ components/         # React ç»„ä»¶
â”‚   â”œâ”€â”€ ui/             # Shadcn UI ç»„ä»¶
â”‚   â”œâ”€â”€ map/            # åœ°å›¾ç›¸å…³ç»„ä»¶
â”‚   â””â”€â”€ citylord/       # æ ¸å¿ƒæ¸¸æˆé€»è¾‘ç»„ä»¶
â”œâ”€â”€ hooks/              # è‡ªå®šä¹‰ React Hooks
â”œâ”€â”€ lib/                # åº“å‡½æ•°å’Œå·¥å…·å‡½æ•°
â”œâ”€â”€ prisma/             # Prisma schema å’Œ migrations
â”œâ”€â”€ public/             # é™æ€èµ„æº
â”œâ”€â”€ scripts/            # è¾…åŠ©è„šæœ¬
â””â”€â”€ android/            # Capacitor Android é¡¹ç›®
```

## ğŸ“œ å¯ç”¨è„šæœ¬ (Available Scripts)

åœ¨ `package.json` ä¸­ï¼Œä½ å¯ä»¥æ‰¾åˆ°ä»¥ä¸‹å¸¸ç”¨è„šæœ¬ï¼š

- `npm run dev`: å¯åŠ¨å¼€å‘æœåŠ¡å™¨ã€‚
- `npm run build`: æ„å»ºç”Ÿäº§ç‰ˆæœ¬ã€‚
- `npm run start`: å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨ã€‚
- `npm run typecheck`: è¿è¡Œ TypeScript ç±»å‹æ£€æŸ¥ã€‚
- `npm run lint`: ä½¿ç”¨ ESLint æ£€æŸ¥ä»£ç ã€‚
- `npm run android`: ä¸º Android å¹³å°æ„å»º Web èµ„æºã€‚

## ğŸ¤ è´¡çŒ®æŒ‡å— (Contributing)

æˆ‘ä»¬æ¬¢è¿ä»»ä½•å½¢å¼çš„è´¡çŒ®ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1.  **Fork** æœ¬ä»“åº“ã€‚
2.  åˆ›å»ºä½ çš„ç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)ã€‚
3.  æäº¤ä½ çš„æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)ã€‚
4.  æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)ã€‚
5.  æ‰“å¼€ä¸€ä¸ª **Pull Request**ã€‚

è¯·ç¡®ä¿ä½ çš„ä»£ç é€šè¿‡äº† `lint` å’Œ `typecheck` æ£€æŸ¥ã€‚

---

## ğŸ“… æ›´æ–°æ—¥å¿— (Changelog)

### 2026-02-15: ğŸš€ æ€§èƒ½é‡æ„ä¸éƒ¨ç½²å‡†å¤‡

**æ ¸å¿ƒä¼˜åŒ–:**

1.  **React æ€§èƒ½ä¼˜åŒ–**:
    *   å¯¹æ ¸å¿ƒç»„ä»¶ `game-page-content.tsx` è¿›è¡Œäº†å…¨é¢çš„æ€§èƒ½é‡æ„ã€‚
    *   é€šè¿‡ `React.memo` åŒ…è£¹æ‰€æœ‰ä¸»è¦å­ç»„ä»¶ï¼Œå¹¶ä½¿ç”¨ `useCallback` ç¨³å®šäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œæœ‰æ•ˆé˜»æ­¢äº†ç”±é«˜é¢‘ GPS æ›´æ–°å¼•èµ·çš„éå¿…è¦é‡æ¸²æŸ“ï¼Œç¡®ä¿ UI æµç•…ã€‚
2.  **æ„å»ºä¸ç±»å‹ä¿®å¤**:
    *   è§£å†³äº†å¤§é‡ TypeScript ç±»å‹é”™è¯¯ï¼ŒåŒ…æ‹¬ `room_messages`ã€`user_missions` ç­‰æ¨¡å‹çš„ç±»å‹æ¨æ–­é—®é¢˜ã€‚
    *   é€šè¿‡æ·»åŠ ç±»å‹å£°æ˜æ–‡ä»¶ (`capacitor-modules.d.ts`) è§£å†³äº† Capacitor æ’ä»¶ `@capacitor/sensors` å’Œ `@capacitor/sound` ç¼ºå¤±æ¨¡å—çš„æŠ¥é”™ã€‚
    *   ä¿®å¤äº† `lord-center` é¡µé¢çš„ React Hook æ¡ä»¶æ¸²æŸ“é”™è¯¯ï¼Œç¡®ä¿äº†ç»„ä»¶æ¸²æŸ“çš„ç¨³å®šæ€§ã€‚
    *   ä¿®å¤äº† `RankItem.tsx` ä¸­ `User` ç»„ä»¶æœªå®šä¹‰çš„æ„å»ºé”™è¯¯ã€‚

3.  **éƒ¨ç½²éªŒè¯**:
    *   æˆåŠŸæ‰§è¡Œ `npm run build`ï¼ŒéªŒè¯é¡¹ç›®å·²å…·å¤‡éƒ¨ç½²æ¡ä»¶ã€‚
    *   æ¸…ç†äº† Prisma ç¼“å­˜å¹¶é‡æ–°ç”Ÿæˆäº† Prisma Clientï¼Œè§£å†³äº† `EPERM` æ–‡ä»¶æƒé™é—®é¢˜ã€‚

---
*ä¹‹å‰çš„æ›´æ–°æ—¥å¿—...*
